<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Marketing Email Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{
      --brand:#00C9A7;
      --ink:#0b111a;
      --muted:#64748b;
      --line:#e5e7eb;
      --bg:#f6f8fa;
      --card:#ffffff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:1024px;margin:20px auto;padding:0 12px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.06)}
    .head{padding:16px;border-bottom:1px solid var(--line);display:flex;gap:10px;align-items:center;justify-content:space-between}
    .head h1{font-size:18px;margin:0}
    .pill{display:inline-flex;align-items:center;gap:6px;background:rgba(0,201,167,.08);color:#055e50;border:1px solid rgba(0,201,167,.25);padding:6px 10px;border-radius:999px;font-weight:700}
    .body{padding:16px}
    .muted{color:var(--muted);font-size:12px}

    .grid{display:grid;gap:12px;grid-template-columns:repeat(2,1fr)}
    .row-inline{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    label{display:block;font-size:12px;font-weight:600;color:#111;margin-bottom:6px}
    input[type="text"],input[type="url"],select,textarea{
      width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;font:14px/1.4 inherit
    }
    textarea{min-height:220px}

    .btn{appearance:none;border:1px solid var(--line);border-radius:10px;padding:10px 14px;background:#fff;cursor:pointer;font-weight:700}
    .btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
    .btn.ghost{background:#f8fafc}
    .btn.small{padding:6px 10px;font-size:12px}

    .row-card{border:1px solid var(--line);border-radius:12px;padding:12px;margin-top:12px;background:#fff}
    .row-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;padding:8px 10px;border-radius:10px;background:#f9fbfb;border:1px dashed rgba(0,201,167,.35)}
    .row-title{display:flex;align-items:center;gap:8px}
    .row-badge{background:var(--brand);color:#fff;padding:2px 8px;border-radius:999px;font-weight:700;font-size:12px}

    .cols{display:grid;gap:10px}
    .col-card{border:1px solid var(--line);border-radius:10px;padding:12px;background:#fcfefd}
    .col-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .col-badge{background:#eafff9;color:#055e50;border:1px solid rgba(0,201,167,.35);padding:2px 8px;border-radius:999px;font-weight:700;font-size:12px}

    .preview{background:#f8fafc;border:1px dashed var(--line);border-radius:12px;overflow:auto;padding:10px}

    .js-ok{background:#eafff3;color:#065f46;border:1px solid #10b981}
    .js-bad{background:#fff1f2;color:#9f1239;border:1px solid #fecdd3}

    @media (max-width:900px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="head">
        <h1>Marketing Email Builder</h1>
        <span class="pill">Images / GIF / Button / Text</span>
      </div>
      <div class="body">

        <p id="js_status" class="pill js-bad" style="margin:0 0 10px 0">JS: not running</p>

        <p class="muted">No default padding; set <b>Row</b> and <b>Column</b> padding (px or CSS shorthand). Header/footer fixed. All links get UTMs.</p>

        <div class="grid">
          <div><label>Preheader (hidden preview text)</label><input id="preheader" type="text" placeholder="Short summary shown in inbox"></div>
          <div><label>Header top color (hex, optional)</label><input id="hdr_color" placeholder="#00C9A7"></div>

          <div><label>utm_source</label><input id="utm_source" value="email"></div>
          <div><label>utm_medium</label><input id="utm_medium" value="crm"></div>
          <div><label>utm_campaign</label><input id="utm_campaign" value="promo_generic"></div>
          <div><label>utm_content</label><input id="utm_content" value="hero_main"></div>
          <div><label>utm_term (optional)</label><input id="utm_term" value=""></div>
        </div>

        <div class="grid" style="margin-top:8px;">
          <div><label>Hero image URL (optional)</label><input id="hero_url" type="url" placeholder="https://cdn.../hero.jpg"></div>
          <div><label>Hero click URL (optional)</label><input id="hero_href" type="url" placeholder="https://www.netmeds.com/..."></div>
        </div>

        <div class="row-inline" style="margin-top:12px">
          <button class="btn" id="add_row">+ Add Row</button>
          <span class="muted">Then add columns inside each row (Image / GIF / Button / Text).</span>
        </div>

        <div id="rows_wrap"></div>

        <div class="row-inline" style="margin-top:18px;margin-bottom:6px">
          <button class="btn ghost" id="gen">Generate</button>
          <button class="btn ghost" id="copy">Copy Final HTML</button>
          <button class="btn primary" id="download">Download .html</button>
        </div>

        <div style="margin-top:6px">
          <label><b>Final Email HTML</b></label>
          <textarea id="out_html" readonly></textarea>

          <!-- Desktop preview -->
          <div style="margin-top:8px">
            <div class="muted" style="margin-bottom:6px"><b>Desktop preview</b></div>
            <iframe id="preview_iframe" class="preview" style="width:100%;min-height:500px;border:0;background:#fff"></iframe>
          </div>

          <!-- Mobile preview (stacked below) -->
          <div style="margin-top:12px">
            <div class="muted" style="margin-bottom:6px"><b>Mobile preview (375px)</b></div>
            <div style="border:1px solid var(--line);border-radius:12px;background:#fff;padding:0 6px 6px;max-width:390px">
              <iframe id="preview_mobile_iframe" style="width:375px;max-width:100%;min-height:500px;border:0;background:#fff"></iframe>
            </div>
          </div>

          <p class="muted" style="margin-top:6px">Tip: paste this full HTML into your ESP’s code editor, or keep using the “Download .html” button.</p>
        </div>

      </div>
    </div>
  </div>

  <script>
  (function(){
    try{
      function $(id){ return document.getElementById(id); }
      function esc(s){
        s = (s==null?"":String(s));
        return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")
                .replace(/"/g,"&quot;").replace(/'/g,"&#39;");
      }
      function withUTM(raw,utm){
        if(!raw) return "";
        if(!/^https?:\/\//i.test(raw)) return raw;
        var glue = raw.indexOf("?")!==-1 ? "&" : "?";
        var params = [];
        function add(k,v){ if(v) params.push(encodeURIComponent(k)+"="+encodeURIComponent(v)); }
        add("utm_source",utm.utm_source);
        add("utm_medium",utm.utm_medium);
        add("utm_campaign",utm.utm_campaign);
        add("utm_content",utm.utm_content);
        add("utm_term",utm.utm_term);
        return raw + (params.length? glue+params.join("&") : "");
      }
      function setIframeHTML(id, html){
        var ifr = $(id);
        if(!ifr) return;
        ifr.onload = function(){
          try{
            var b = ifr.contentDocument && ifr.contentDocument.body;
            if(b){ ifr.style.height = Math.max(500, b.scrollHeight + 20) + "px"; }
          }catch(e){}
        };
        ifr.srcdoc = html;
      }

      var rowsWrap = $("rows_wrap");
      var jsBadge = $("js_status");
      if(jsBadge){ jsBadge.textContent = "JS: OK"; jsBadge.className = "pill js-ok"; }

      function renumberColumns(rowEl){
        var cols = rowEl.querySelectorAll("[data-col]");
        for(var i=0;i<cols.length;i++){
          var badge = cols[i].querySelector(".col-badge");
          if(badge) badge.textContent = "Column " + (i+1);
        }
      }

      function onTypeChange(colEl){
        var typeSel = colEl.querySelector("[data-type]");
        var textOnlyBlock = colEl.querySelector("[data-textonly]");
        if(!typeSel || !textOnlyBlock) return;
        var v = typeSel.value;
        textOnlyBlock.style.display = (v==="text") ? "" : "none";
        var val = colEl.querySelector("[data-value]");
        var href = colEl.querySelector("[data-href]");
        if(v==="text"){
          if(val) val.placeholder = "Enter text content";
          if(href) href.placeholder = "(optional) not used for text";
        }else if(v==="button"){
          if(val) val.placeholder = "CTA text";
          if(href) href.placeholder = "https://... (REQUIRED for button)";
        }else{
          if(val) val.placeholder = "Image/GIF: image URL";
          if(href) href.placeholder = "(optional) click URL";
        }
      }

      function addRow(){
        var r = document.createElement("div");
        r.className = "row-card";
        r.setAttribute("data-row","1");
        r.innerHTML =
          '<div class="row-bar">' +
            '<div class="row-title">' +
              '<span class="row-badge">Row</span>' +
              '<div class="row-inline">' +
                '<label style="margin:0">Row padding</label>' +
                '<input type="text" data-rowpad placeholder="e.g., 0 or 16 8 16 8" style="width:220px">' +
              '</div>' +
            '</div>' +
            '<div class="row-inline">' +
              '<button type="button" class="btn small" data-addcol>+ Add Column</button>' +
              '<button type="button" class="btn small" data-addrow>+ Row Below</button>' +
              '<button type="button" class="btn small" data-removerow>Remove Row</button>' +
            '</div>' +
          '</div>' +
          '<div class="cols" data-cols></div>';

        r.querySelector("[data-addcol]").onclick = function(){ addCol(r); renumberColumns(r); };
        r.querySelector("[data-addrow]").onclick = function(){ r.after(addRow()); };
        r.querySelector("[data-removerow]").onclick = function(){ r.remove(); };
        rowsWrap.appendChild(r);
        return r;
      }

      function addCol(rowEl){
        var c = document.createElement("div");
        c.className = "col-card";
        c.setAttribute("data-col","1");
        c.innerHTML =
          '<div class="col-title">' +
            '<span class="col-badge">Column</span>' +
            '<button type="button" class="btn small" data-removecol>Remove Column</button>' +
          '</div>' +

          '<div class="row-inline">' +
            '<div style="min-width:180px;flex:1 1 220px">' +
              '<label>Type</label>' +
              '<select data-type>' +
                '<option value="image">Image</option>' +
                '<option value="gif">GIF</option>' +
                '<option value="button">Button</option>' +
                '<option value="text">Text</option>' +
              '</select>' +
            '</div>' +
            '<div style="min-width:180px;flex:1 1 220px">' +
              '<label>Alignment</label>' +
              '<select data-align>' +
                '<option value="center" selected>Center</option>' +
                '<option value="left">Left</option>' +
                '<option value="right">Right</option>' +
              '</select>' +
            '</div>' +
            '<div style="min-width:220px;flex:2 1 280px">' +
              '<label>Column padding (px or CSS)</label>' +
              '<input type="text" data-colpad placeholder="e.g., 0 or 8 8 8 8">' +
            '</div>' +
          '</div>' +

          '<div class="grid" style="margin-top:8px">' +
            '<div>' +
              '<label>Value</label>' +
              '<input data-value type="text" placeholder="Image/GIF: image URL · Button: CTA text · Text: content">' +
            '</div>' +
            '<div>' +
              '<label>Link (optional for images; REQUIRED for button)</label>' +
              '<input data-href type="url" placeholder="https://... (click URL)">' +
            '</div>' +
          '</div>' +

          '<div class="grid" style="margin-top:8px">' +
            '<div><label>Alt text (images only)</label><input data-alt type="text" maxlength="150" placeholder="Describe the image"></div>' +
            '<div><label>Width (px, optional for images)</label><input data-w type="text" placeholder="e.g., 260"></div>' +
          '</div>' +

          '<div data-textonly style="display:none;margin-top:8px">' +
            '<div class="row-inline" style="gap:12px">' +
              '<div style="min-width:160px;flex:1 1 200px">' +
                '<label>Text style</label>' +
                '<select data-textkind>' +
                  '<option value="p" selected>Paragraph</option>' +
                  '<option value="h1">H1</option>' +
                  '<option value="h2">H2</option>' +
                  '<option value="h3">H3</option>' +
                '</select>' +
              '</div>' +
            '</div>' +
          '</div>';

        c.querySelector("[data-removecol]").onclick = function(){ c.remove(); renumberColumns(rowEl); };
        var typeSel = c.querySelector("[data-type]");
        typeSel.onchange = function(){ onTypeChange(c); };
        onTypeChange(c);
        rowEl.querySelector("[data-cols]").appendChild(c);
      }

      $("add_row").onclick = function(){ addRow(); };
      addRow();

      function readRows(){
        var out = [];
        var rowEls = rowsWrap.querySelectorAll("[data-row]");
        for(var i=0;i<rowEls.length;i++){
          var row = rowEls[i];
          var rowPad = (row.querySelector("[data-rowpad]") ? row.querySelector("[data-rowpad]").value : "").trim();
          var cols = [];
          var colEls = row.querySelectorAll("[data-cols] > [data-col]");
          for(var j=0;j<colEls.length;j++){
            var col = colEls[j];
            cols.push({
              type:  col.querySelector("[data-type]").value,
              value: col.querySelector("[data-value]").value.trim(),
              href:  col.querySelector("[data-href]").value.trim(),
              alt:   col.querySelector("[data-alt]").value.trim(),
              w:     col.querySelector("[data-w]").value.trim(),
              pad:   (col.querySelector("[data-colpad]") ? col.querySelector("[data-colpad]").value.trim() : ""),
              align: (col.querySelector("[data-align]") ? col.querySelector("[data-align]").value.trim() : "center"),
              textkind: (col.querySelector("[data-textkind]") ? col.querySelector("[data-textkind]").value : "p")
            });
          }
          out.push({ pad: rowPad, cols: cols });
        }
        return out;
      }

      function headerHTML(utm, overrideColor){
        var bg = (overrideColor && /^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(overrideColor)) ? overrideColor : "#00C9A7";
        var h = '';
        h += '<table align="center" border="0" cellpadding="0" cellspacing="0" style="background-color:'+bg+'; width:100%; height:72px;"><tbody><tr>';
        h +=   '<td style="width:20%; padding:12px 0 12px 14px;"><img src="https://cdn.pixelbin.io/v2/plain-cake-860195/original/Communication/2023/nov/email/orderplaced/headerLft.png" alt=""></td>';
        h +=   '<td style="width:60%; padding:12px 0; text-align:center;"><a href="'+esc(withUTM("https://www.netmeds.com/",utm))+'" style="text-decoration:none;"><img src="https://cdn.pixelbin.io/v2/plain-cake-860195/original/Communication/2023/nov/email/orderplaced/netmeds-logo.png" alt="Netmeds"></a></td>';
        h +=   '<td style="width:20%; padding:12px 14px 12px 0;"><img src="https://cdn.pixelbin.io/v2/plain-cake-860195/original/Communication/2023/nov/email/orderplaced/headerRgt.png" alt=""></td>';
        h += '</tr></tbody></table>';
        return h;
      }

      function footerHTML(utm){
        var f = '';
        f += '<table align="center" border="0" cellpadding="0" cellspacing="0" style="font-family:Arial, Helvetica, sans-serif;background:#eeeeee;width:100%; padding:24px 32px 40px; border-bottom:1px solid rgb(205 205 205);"><tbody><tr><td>';
        f +=   '<p style="color:#000;font-family:Arial Black;font-size:18px;font-style:normal;font-weight:900;line-height:normal;letter-spacing:-0.54px; margin:0; padding:0 0 24px;">Connect with us<br />';
        f +=     '<a href="'+esc(withUTM("https://www.facebook.com/NetMeds",utm))+'" style="text-decoration:none;vertical-align:middle; display:inline-block; margin:16px 12px 0 0;" target="_blank"><img src="https://cdn.pixelbin.io/v2/plain-cake-860195/original/Communication/2023/nov/email/orderplaced/icon-FB.png" alt="Facebook"></a>';
        f +=     '<a href="'+esc(withUTM("https://twitter.com/NetMeds",utm))+'" style="text-decoration:none;vertical-align:middle; display:inline-block; margin:16px 12px 0 0;" target="_blank"><img src="https://cdn.pixelbin.io/v2/plain-cake-860195/original/Communication/2023/nov/email/orderplaced/icon-Twitter.png" alt="Twitter"></a>';
        f +=     '<a href="'+esc(withUTM("https://www.instagram.com/netmedsofficial",utm))+'" style="text-decoration:none;vertical-align:middle; display:inline-block; margin:16px 12px 0 0;" target="_blank"><img src="https://cdn.pixelbin.io/v2/plain-cake-860195/original/Communication/2023/nov/email/orderplaced/icon-Instagram.png" alt="Instagram"></a></p>';
        f +=   '<p style="color:#000;font-family:Arial Black;font-size:18px;font-style:normal;font-weight:900;line-height:normal;letter-spacing:-0.54px; margin:0; padding:0;">Download the app<br />';
        f +=     '<a href="'+esc(withUTM("https://play.google.com/store/apps/details?id=com.NetmedsMarketplace.Netmeds&hl=en",utm))+'" style="text-decoration:none;vertical-align:middle; display:inline-block; margin:16px 16px 0 0;" target="_blank"><img src="https://cdn.pixelbin.io/v2/plain-cake-860195/original/Communication/2023/nov/email/orderplaced/icon-Android.png" alt="Android"></a>';
        f +=     '<a href="'+esc(withUTM("https://itunes.apple.com/in/app/netmeds/id1011070011?mt=8",utm))+'" style="text-decoration:none;vertical-align:middle; display:inline-block; margin:16px 0 0;" target="_blank"><img src="https://cdn.pixelbin.io/v2/plain-cake-860195/original/Communication/2023/nov/email/orderplaced/icon-IOS.png" alt="iOS"></a></p>';
        f += '</td></tr></tbody></table>';
        f += '<table align="center" border="0" cellpadding="0" cellspacing="0" style="width:100%;background:#eeeeee; padding:12px 32px; margin:0; border-bottom:1px solid rgb(205 205 205);"><tbody>';
        f +=   '<tr><td style="color:rgba(11,18,25,0.5);text-align:left; padding:15px 0 0;  font-family:Arial; font-size:14px; font-style:normal;">© 2025 Netmeds Marketplace Limited. All Rights Reserved</td></tr>';
        f +=   '<tr><td style="color:rgba(11,18,25,0.5);text-align:left; padding:15px 0 0;  font-family:Arial; font-size:14px; font-style:normal;"><a href="'+esc(withUTM("https://www.netmeds.tech/terms-and-conditions",utm))+'" style="color:#08332C;font-weight:700; line-height:18px; letter-spacing:-0.07px; text-decoration:none;">Terms &amp; Conditions</a></td></tr>';
        f +=   '<tr><td style="padding:0;"><table role="presentation" width="100%" border="0" cellpadding="0" cellspacing="0"><tr>';
        f +=       '<td style="text-align:left;"><p style="color:rgba(11,18,25,0.5);font-size:12px;"><a href="{{MANAGE_PREFERENCES_URL}}">Manage My Preferences</a></p></td>';
        f +=       '<td style="text-align:right;"><p style="color:rgba(11,18,25,0.5);font-size:12px;"><a href="{{UNSUBSCRIBE_URL}}">Unsubscribe</a></p></td>';
        f +=     '</tr></table></td></tr></tbody></table>';
        return f;
      }

      function nl2br(s){
        return s.replace(/\r\n|\n\r|\r|\n/g, "<br>");
      }
      function buildTextHTML(kind, raw){
        var t = esc(raw);
        // single style attribute only (fix for previous bug)
        if(kind==="h1") return '<h1 style="margin:0;padding:0;font-family:Arial, Helvetica, sans-serif;color:#0b111a;font-size:28px;line-height:34px">'+ t +'</h1>';
        if(kind==="h2") return '<h2 style="margin:0;padding:0;font-family:Arial, Helvetica, sans-serif;color:#0b111a;font-size:22px;line-height:28px">'+ t +'</h2>';
        if(kind==="h3") return '<h3 style="margin:0;padding:0;font-family:Arial, Helvetica, sans-serif;color:#0b111a;font-size:18px;line-height:24px">'+ t +'</h3>';
        return '<p style="margin:0;padding:0;font-family:Arial, Helvetica, sans-serif;color:#0b111a;font-size:14px;line-height:20px">'+ nl2br(t) +'</p>';
      }

      function buildCellHTML(col, utm){
        var wAttr = col.w ? (' width="'+ (Number(col.w)||col.w) +'"') : '';

        if(col.type==="button"){
          var text = col.value;
          var href = col.href;
          if(!text || !href) return "";
          return '<a href="'+ esc(withUTM(href,utm)) +'" ' +
                 'style="background:#00C9A7;color:#ffffff;border-radius:999px;display:inline-block;' +
                        'padding:14px 22px;font:700 16px/16px Arial,Helvetica,sans-serif;text-decoration:none">' +
                 esc(text) + '</a>';
        }

        if(col.type==="text"){
          var kind = (col.textkind||"p");
          var content = col.value || "";
          return buildTextHTML(kind, content);
        }

        var src  = col.value || "";
        var href2 = col.href || "";
        var alt2  = col.alt  || "";
        if(!src) return "";
        var img = '<img src="'+ esc(src) +'"'+ wAttr +
                  ' style="display:block;width:100%;height:auto;border:0;outline:none;text-decoration:none;-ms-interpolation-mode:bicubic"' +
                  ' alt="'+ esc(alt2) +'">';
        return href2 ? ('<a href="'+ esc(withUTM(href2,utm)) +'">'+ img +'</a>') : img;
      }

      function buildContentHTML(rows, utm, hero){
        var html = "";

        if(hero.url){
          html += '<tr><td style="font-size:0; line-height:0; padding:0; text-align:center;" align="center">';
          if(hero.href){ html += '<a href="'+ esc(withUTM(hero.href,utm)) +'">'; }
          html += '<img src="'+ esc(hero.url) +'" width="600" style="display:block;width:100%;height:auto;border:0;outline:none;text-decoration:none;-ms-interpolation-mode:bicubic" alt="">';
          if(hero.href){ html += '</a>'; }
          html += '</td></tr>';
        }

        for(var i=0;i<rows.length;i++){
          var row = rows[i];
          if(!row.cols.length) continue;

          var rowPadStyle = 'padding:' + ((row.pad!=="") ? esc(row.pad) : '0') + ';';
          html += '<tr><td style="'+ rowPadStyle +' font-size:0; line-height:0;">' +
                  '<table role="presentation" width="100%" border="0" cellpadding="0" cellspacing="0" ' +
                  'style="border-collapse:collapse; border-spacing:0; mso-table-lspace:0pt; mso-table-rspace:0pt;"><tr>';

          var widthPct = Math.floor(100/row.cols.length);
          for(var j=0;j<row.cols.length;j++){
            var c = row.cols[j];
            var padStyle = 'padding:' + ((c.pad!=="") ? esc(c.pad) : '0') + ';';
            var align = (c.align||"center").toLowerCase();
            var safeAlign = (align==="left"||align==="right") ? align : "center";
            html += '<td valign="top" align="'+ safeAlign +'" ' +
                    'style="'+ padStyle +' width:'+ widthPct +'%; font-size:0; line-height:0; text-align:'+ safeAlign +';">' +
                      buildCellHTML(c, utm) +
                    '</td>';
          }

          html += '</tr></table></td></tr>';
        }

        return html;
      }

      function readUTM(){
        return {
          utm_source: $("utm_source").value.trim(),
          utm_medium: $("utm_medium").value.trim(),
          utm_campaign: $("utm_campaign").value.trim(),
          utm_content: $("utm_content").value.trim(),
          utm_term: $("utm_term").value.trim()
        };
      }

      function buildFullHTML(){
        var utm = readUTM();
        var hero = { url: $("hero_url").value.trim(), href: $("hero_href").value.trim() };
        var rows = readRows();
        var hdrColor = $("hdr_color").value.trim();
        var preH = $("preheader").value.trim();

        var preheaderHTML = '';
        if(preH){
          preheaderHTML += '<div style="display:none;visibility:hidden;mso-hide:all;font-size:1px;line-height:1px;max-height:0;opacity:0;overflow:hidden;">'+ esc(preH) +'</div>';
          preheaderHTML += '<div style="display:none;visibility:hidden;mso-hide:all;font-size:1px;line-height:1px;max-height:0;opacity:0;overflow:hidden;">&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;</div>';
        }

        var bodyHTML = '';
        bodyHTML += preheaderHTML;
        bodyHTML += '<table align="center" border="0" cellpadding="0" cellspacing="0" ' +
                    'style="margin:0 auto; font-family:Arial, Helvetica, sans-serif; max-width:600px; width:100%;' +
                    'border-collapse:collapse; border-spacing:0; mso-table-lspace:0pt; mso-table-rspace:0pt;"><tbody>';
        bodyHTML +=   '<tr><td style="background-color:#ffffff; padding:0; font-size:0; line-height:0;">';
        bodyHTML +=     headerHTML(utm, hdrColor);
        bodyHTML +=     '<table role="presentation" align="center" border="0" cellpadding="0" cellspacing="0" ' +
                        'style="width:600px; max-width:600px; background:#ffffff; text-align:left;' +
                               'border-collapse:collapse; border-spacing:0; mso-table-lspace:0pt; mso-table-rspace:0pt;"><tbody>';
        bodyHTML +=       buildContentHTML(rows, utm, hero);
        bodyHTML +=     '</tbody></table>';
        bodyHTML +=     footerHTML(utm);
        bodyHTML +=     '<table align="center" border="0" cellpadding="0" cellspacing="0" ' +
                        'style="border-collapse:collapse; border-spacing:0; mso-table-lspace:0pt; mso-table-rspace:0pt;"></table>';
        bodyHTML +=   '</td></tr></tbody></table>';

        var full = '';
        full += '<!doctype html>\n<html>\n<head>\n';
        full += '  <meta charset="utf-8">\n';
        full += '  <meta name="x-apple-disable-message-reformatting">\n';
        full += '  <meta name="viewport" content="width=device-width, initial-scale=1">\n';
        full += '  <title>Netmeds Email</title>\n';
        full += '</head>\n<body bgcolor="#ffffff" style="margin:0;padding:0;background-color:#ffffff;">\n';
        full += bodyHTML + '\n</body>\n</html>';

        return full;
      }

      function generate(){
        var html = buildFullHTML();
        $("out_html").value = html;
        setIframeHTML("preview_iframe", html);
        setIframeHTML("preview_mobile_iframe", html);
      }
      $("gen").onclick = generate;

      $("copy").onclick = function(){
        if(!$("out_html").value.trim()) generate();
        var v = $("out_html").value;
        try{
          if(navigator.clipboard && navigator.clipboard.writeText){
            navigator.clipboard.writeText(v);
          }else{
            $("out_html").focus(); $("out_html").select();
            document.execCommand("copy");
          }
          var b=$("copy"), t=b.textContent; b.textContent="Copied ✓";
          setTimeout(function(){ b.textContent=t; },1200);
        }catch(e){
          alert("Copy failed. Please select the text and press Ctrl/Cmd+C.");
        }
      };

      $("download").onclick = function(){
        if(!$("out_html").value.trim()) generate();
        var blob = new Blob([ $("out_html").value ], {type: "text/html;charset=utf-8"});
        var url = URL.createObjectURL(blob);
        var a = document.createElement("a");
        a.href = url; a.download = "netmeds-email.html";
        document.body.appendChild(a); a.click(); a.remove();
        setTimeout(function(){ URL.revokeObjectURL(url); }, 1200);
      };

    }catch(err){
      console.error(err);
      var badge = document.getElementById("js_status");
      if(badge){ badge.textContent = "JS error: " + err.message; badge.className = "pill js-bad"; }
    }
  })();
  </script>
</body>
</html>
