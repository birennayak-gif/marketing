<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Marketing Email Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{
      --brand:#00C9A7;
      --ink:#0b111a;
      --muted:#64748b;
      --line:#e5e7eb;
      --bg:#f6f8fa;
      --card:#ffffff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:1024px;margin:20px auto;padding:0 12px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.06)}
    .head{padding:16px 16px;border-bottom:1px solid var(--line);display:flex;gap:10px;align-items:center;justify-content:space-between}
    .head h1{font-size:18px;margin:0}
    .pill{display:inline-flex;align-items:center;gap:6px;background:rgba(0,201,167,.08);color:#055e50;border:1px solid rgba(0,201,167,.25);padding:6px 10px;border-radius:999px;font-weight:700}
    .body{padding:16px}
    .muted{color:var(--muted);font-size:12px}

    /* form controls */
    .grid{display:grid;gap:12px;grid-template-columns:repeat(2,1fr)}
    .row-inline{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    label{display:block;font-size:12px;font-weight:600;color:#111;margin-bottom:6px}
    input[type="text"],input[type="url"],select,textarea{
      width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;font:14px/1.4 inherit
    }
    textarea{min-height:220px}

    /* buttons */
    .btn{appearance:none;border:1px solid var(--line);border-radius:10px;padding:10px 14px;background:#fff;cursor:pointer;font-weight:700}
    .btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
    .btn.ghost{background:#f8fafc}
    .btn.small{padding:6px 10px;font-size:12px}

    /* builder UI */
    .row-card{border:1px solid var(--line);border-radius:12px;padding:12px;margin-top:12px;background:#fff}
    .row-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;padding:8px 10px;border-radius:10px;background:#f9fbfb;border:1px dashed rgba(0,201,167,.35)}
    .row-title{display:flex;align-items:center;gap:8px}
    .row-badge{background:var(--brand);color:#fff;padding:2px 8px;border-radius:999px;font-weight:700;font-size:12px}

    .cols{display:grid;gap:10px}
    .col-card{border:1px solid var(--line);border-radius:10px;padding:12px;background:#fcfefd}
    .col-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .col-badge{background:#eafff9;color:#055e50;border:1px solid rgba(0,201,167,.35);padding:2px 8px;border-radius:999px;font-weight:700;font-size:12px}

    .preview{background:#f8fafc;border:1px dashed var(--line);border-radius:12px;overflow:auto;padding:10px}

    @media (max-width:900px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="head">
        <h1>Marketing Email Builder</h1>
        <span class="pill">Images / GIF / Button / YouTube</span>
      </div>
      <div class="body">

        <p class="muted">No default padding; set <b>Row</b> and <b>Column</b> padding (px or CSS shorthand). Header/footer fixed. All links get UTMs.</p>

        <!-- UTMs / color -->
        <div class="grid">
          <div><label>utm_source</label><input id="utm_source" value="email"></div>
          <div><label>utm_medium</label><input id="utm_medium" value="crm"></div>
          <div><label>utm_campaign</label><input id="utm_campaign" value="promo_generic"></div>
          <div><label>utm_content</label><input id="utm_content" value="hero_main"></div>
          <div><label>utm_term (optional)</label><input id="utm_term" value=""></div>
          <div><label>Header top color (hex, optional)</label><input id="hdr_color" placeholder="#00C9A7"></div>
        </div>

        <!-- Hero -->
        <div class="grid" style="margin-top:8px;">
          <div><label>Hero image URL (optional)</label><input id="hero_url" type="url" placeholder="https://cdn.../hero.jpg"></div>
          <div><label>Hero click URL (optional)</label><input id="hero_href" type="url" placeholder="https://www.netmeds.com/..."></div>
        </div>

        <!-- Row controls (always visible, top) -->
        <div class="row-inline" style="margin-top:12px">
          <button class="btn" id="add_row">+ Add Row</button>
          <span class="muted">Then add columns inside each row (image / gif / button / YouTube).</span>
        </div>

        <!-- Rows go here -->
        <div id="rows_wrap"></div>

        <!-- OUTPUT CONTROLS placed just above the Final HTML section -->
        <div class="row-inline" style="margin-top:18px;margin-bottom:6px">
          <button class="btn ghost" id="gen">Generate</button>
          <button class="btn ghost" id="copy">Copy Final HTML</button>
          <button class="btn primary" id="download">Download .html</button>
        </div>

        <!-- OUTPUT -->
        <div style="margin-top:6px">
          <label><b>Final Email HTML</b></label>
          <textarea id="out_html" readonly></textarea>
          <div class="preview" id="preview" style="margin-top:8px"></div>
          <p class="muted" style="margin-top:6px">Tip: paste this full HTML into your ESP’s code editor, or keep using the “Download .html” button.</p>
        </div>

      </div>
    </div>
  </div>

  <script>
  (function(){
    // ---------- DOM helpers ----------
    const $ = (id)=>document.getElementById(id);
    const rowsWrap = $("rows_wrap");

    // ---------- utils ----------
    const esc = (s)=> (s==null?"":String(s))
      .replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")
      .replace(/"/g,"&quot;").replace(/'/g,"&#39;");

    // robust YouTube ID finder
    function youThumb(url){
      if(!url) return "";
      let m = url.match(/youtu\.be\/([A-Za-z0-9_-]{6,})/); if(m) return `https://img.youtube.com/vi/${m[1]}/hqdefault.jpg`;
      m = url.match(/[?&]v=([A-Za-z0-9_-]{6,})/);         if(m) return `https://img.youtube.com/vi/${m[1]}/hqdefault.jpg`;
      m = url.match(/\/(?:embed|v)\/([A-Za-z0-9_-]{6,})/);if(m) return `https://img.youtube.com/vi/${m[1]}/hqdefault.jpg`;
      return "";
    }

    // we construct UTMs without URL() to avoid CSP issues anywhere
    function withUTM(raw,utm){
      if(!raw) return "";
      if(!/^https?:\/\//i.test(raw)) return raw; // leave relative or non-http as-is
      const glue = raw.indexOf("?")!==-1 ? "&" : "?";
      const params = [];
      function add(k,v){ if(v) params.push(encodeURIComponent(k)+"="+encodeURIComponent(v)); }
      add("utm_source",utm.utm_source);
      add("utm_medium",utm.utm_medium);
      add("utm_campaign",utm.utm_campaign);
      add("utm_content",utm.utm_content);
      add("utm_term",utm.utm_term);
      return raw + (params.length? glue+params.join("&") : "");
    }

    // ---------- rows / columns ----------
    function renumberColumns(rowEl){
      const cols = rowEl.querySelectorAll("[data-col]");
      cols.forEach((c,idx)=>{
        const badge = c.querySelector(".col-badge");
        if(badge) badge.textContent = `Column ${idx+1}`;
      });
    }

    function addRow(){
      const r = document.createElement("div");
      r.className = "row-card";
      r.setAttribute("data-row","1");
      r.innerHTML = `
        <div class="row-bar">
          <div class="row-title">
            <span class="row-badge">Row</span>
            <div class="row-inline">
              <label style="margin:0">Row padding</label>
              <input type="text" data-rowpad placeholder="e.g., 0 or 16 8 16 8" style="width:220px">
            </div>
          </div>
          <div class="row-inline">
            <button type="button" class="btn small" data-addcol>+ Add Column</button>
            <button type="button" class="btn small" data-addrow>+ Row Below</button>
            <button type="button" class="btn small" data-removerow>Remove Row</button>
          </div>
        </div>
        <div class="cols" data-cols></div>
      `;
      r.querySelector("[data-addcol]").onclick = ()=> { addCol(r); renumberColumns(r); };
      r.querySelector("[data-addrow]").onclick = ()=> { r.after(addRow()); };
      r.querySelector("[data-removerow]").onclick = ()=> { r.remove(); };
      rowsWrap.appendChild(r);
      return r;
    }

    function addCol(rowEl){
      const c = document.createElement("div");
      c.className = "col-card";
      c.setAttribute("data-col","1");
      c.innerHTML = `
        <div class="col-title">
          <span class="col-badge">Column</span>
          <button type="button" class="btn small" data-removecol>Remove Column</button>
        </div>

        <div class="row-inline">
          <div style="min-width:180px;flex:1 1 220px">
            <label>Type</label>
            <select data-type>
              <option value="image">Image</option>
              <option value="gif">GIF</option>
              <option value="button">Button</option>
              <option value="youtube">YouTube</option>
            </select>
          </div>
          <div style="min-width:180px;flex:1 1 220px">
            <label>Alignment</label>
            <select data-align>
              <option value="center" selected>Center</option>
              <option value="left">Left</option>
              <option value="right">Right</option>
            </select>
          </div>
          <div style="min-width:220px;flex:2 1 280px">
            <label>Column padding (px or CSS)</label>
            <input type="text" data-colpad placeholder="e.g., 0 or 8 8 8 8">
          </div>
        </div>

        <div class="grid" style="margin-top:8px">
          <div>
            <label>Value</label>
            <input data-value type="text" placeholder="Image/GIF: image URL · Button: CTA text · YouTube: video URL">
          </div>
          <div>
            <label>Link (optional for images/YouTube; REQUIRED for button)</label>
            <input data-href type="url" placeholder="https://... (click URL)">
          </div>
        </div>

        <div class="grid" style="margin-top:8px">
          <div><label>Alt text (recommended)</label><input data-alt type="text" maxlength="150" placeholder="Describe the image"></div>
          <div><label>Width (px, optional)</label><input data-w type="text" placeholder="e.g., 260"></div>
        </div>
      `;
      c.querySelector("[data-removecol]").onclick = ()=> { c.remove(); renumberColumns(rowEl); };
      rowEl.querySelector("[data-cols]").appendChild(c);
    }

    $("add_row").onclick = ()=> addRow();
    addRow(); // initial row

    function readRows(){
      const out = [];
      rowsWrap.querySelectorAll("[data-row]").forEach(row=>{
        const rowPad = (row.querySelector("[data-rowpad]")?.value || "").trim();
        const cols = [];
        row.querySelectorAll("[data-cols] > [data-col]").forEach(col=>{
          cols.push({
            type:  col.querySelector("[data-type]").value,
            value: col.querySelector("[data-value]").value.trim(),
            href:  col.querySelector("[data-href]").value.trim(),
            alt:   col.querySelector("[data-alt]").value.trim(),
            w:     col.querySelector("[data-w]").value.trim(),
            pad:   (col.querySelector("[data-colpad]")?.value || "").trim(),
            align: (col.querySelector("[data-align]")?.value || "center").trim()
          });
        });
        out.push({ pad: rowPad, cols });
      });
      return out;
    }

    // ---------- header/footer (strings) ----------
    function headerHTML(utm, overrideColor){
      const bg = (overrideColor && /^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(overrideColor)) ? overrideColor : "#00C9A7";
      let html = '';
      html += '<table align="center" border="0" cellpadding="0" cellspacing="0" style="background-color:'+bg+'; width:100%; height:72px;"><tbody><tr>';
      html +=   '<td style="width:20%; padding:12px 0 12px 14px;"><img src="https://cdn.pixelbin.io/v2/plain-cake-860195/original/Communication/2023/nov/email/orderplaced/headerLft.png" alt=""></td>';
      html +=   '<td style="width:60%; padding:12px 0; text-align:center;"><a href="'+esc(withUTM("https://www.netmeds.com/",utm))+'" style="text-decoration:none;"><img src="https://cdn.pixelbin.io/v2/plain-cake-860195/original/Communication/2023/nov/email/orderplaced/netmeds-logo.png" alt="Netmeds"></a></td>';
      html +=   '<td style="width:20%; padding:12px 14px 12px 0;"><img src="https://cdn.pixelbin.io/v2/plain-cake-860195/original/Communication/2023/nov/email/orderplaced/headerRgt.png" alt=""></td>';
      html += '</tr></tbody></table>';
      return html;
    }

    function footerHTML(utm){
      let html = '';
      html += '<table align="center" border="0" cellpadding="0" cellspacing="0" style="font-family:Arial, Helvetica, sans-serif;background:#eeeeee;width:100%; padding:24px 32px 40px; border-bottom:1px solid rgb(205 205 205);"><tbody><tr><td>';
      html +=   '<p style="color:#000;font-family:Arial Black;font-size:18px;font-style:normal;font-weight:900;line-height:normal;letter-spacing:-0.54px; margin:0; padding:0 0 24px;">Connect with us<br />';
      html +=     '<a href="'+esc(withUTM("https://www.facebook.com/NetMeds",utm))+'" style="text-decoration:none;vertical-align:middle; display:inline-block; margin:16px 12px 0 0;" target="_blank"><img src="https://cdn.pixelbin.io/v2/plain-cake-860195/original/Communication/2023/nov/email/orderplaced/icon-FB.png" alt="Facebook"></a>';
      html +=     '<a href="'+esc(withUTM("https://twitter.com/NetMeds",utm))+'" style="text-decoration:none;vertical-align:middle; display:inline-block; margin:16px 12px 0 0;" target="_blank"><img src="https://cdn.pixelbin.io/v2/plain-cake-860195/original/Communication/2023/nov/email/orderplaced/icon-Twitter.png" alt="Twitter"></a>';
      html +=     '<a href="'+esc(withUTM("https://www.instagram.com/netmedsofficial",utm))+'" style="text-decoration:none;vertical-align:middle; display:inline-block; margin:16px 12px 0 0;" target="_blank"><img src="https://cdn.pixelbin.io/v2/plain-cake-860195/original/Communication/2023/nov/email/orderplaced/icon-Instagram.png" alt="Instagram"></a>';
      html +=     '<a href="'+esc(withUTM("https://youtube.com/@netmeds",utm))+'" style="text-decoration:none;vertical-align:middle; display:inline-block; margin:16px 0 0;" target="_blank"><img src="https://cdn.pixelbin.io/v2/plain-cake-860195/original/Communication/2023/nov/email/orderplaced/icon-Youtube.png" alt="YouTube"></a></p>';
      html +=   '<p style="color:#000;font-family:Arial Black;font-size:18px;font-style:normal;font-weight:900;line-height:normal;letter-spacing:-0.54px; margin:0; padding:0;">Download the app<br />';
      html +=     '<a href="'+esc(withUTM("https://play.google.com/store/apps/details?id=com.NetmedsMarketplace.Netmeds&hl=en",utm))+'" style="text-decoration:none;vertical-align:middle; display:inline-block; margin:16px 16px 0 0;" target="_blank"><img src="https://cdn.pixelbin.io/v2/plain-cake-860195/original/Communication/2023/nov/email/orderplaced/icon-Android.png" alt="Android"></a>';
      html +=     '<a href="'+esc(withUTM("https://itunes.apple.com/in/app/netmeds/id1011070011?mt=8",utm))+'" style="text-decoration:none;vertical-align:middle; display:inline-block; margin:16px 0 0;" target="_blank"><img src="https://cdn.pixelbin.io/v2/plain-cake-860195/original/Communication/2023/nov/email/orderplaced/icon-IOS.png" alt="iOS"></a></p>';
      html += '</td></tr></tbody></table>';

      html += '<table align="center" border="0" cellpadding="0" cellspacing="0" style="width:100%;background:#eeeeee; padding:12px 32px; margin:0; border-bottom:1px solid rgb(205 205 205);"><tbody>';
      html +=   '<tr><td style="color:rgba(11,18,25,0.5);text-align:left; padding:15px 0 0;  font-family:Arial; font-size:14px; font-style:normal;">© 2025 Netmeds Marketplace Limited. All Rights Reserved</td></tr>';
      html +=   '<tr><td style="color:rgba(11,18,25,0.5);text-align:left; padding:15px 0 0;  font-family:Arial; font-size:14px; font-style:normal;"><a href="'+esc(withUTM("https://www.netmeds.tech/terms-and-conditions",utm))+'" style="color:#08332C;font-weight:700; line-height:18px; letter-spacing:-0.07px; text-decoration:none;">Terms &amp; Conditions</a></td></tr>';
      html +=   '<tr><td style="padding:0;"><table role="presentation" width="100%" border="0" cellpadding="0" cellspacing="0"><tr>';
      html +=       '<td style="text-align:left;"><p style="color:rgba(11,18,25,0.5);font-size:12px;"><a href="{{MANAGE_PREFERENCES_URL}}">Manage My Preferences</a></p></td>';
      html +=       '<td style="text-align:right;"><p style="color:rgba(11,18,25,0.5);font-size:12px;"><a href="{{UNSUBSCRIBE_URL}}">Unsubscribe</a></p></td>';
      html +=     '</tr></table></td></tr></tbody></table>';
      return html;
    }

    // ---------- content builders (no default padding) ----------
    function buildCellHTML(col, utm){
      const wAttr = col.w ? ` width="${Number(col.w)||col.w}"` : "";

      if(col.type==="button"){
        const text = col.value;
        const href = col.href;
        if(!text || !href) return "";
        return `<a href="${esc(withUTM(href,utm))}"
                  style="background:#00C9A7;color:#ffffff;border-radius:999px;display:inline-block;
                         padding:14px 22px;font:700 16px/16px Arial,Helvetica,sans-serif;text-decoration:none">${esc(text)}</a>`;
      }

      if(col.type==="youtube"){
        const thumb = youThumb(col.value) || "";
        const link  = col.href || col.value || "#";
        const alt   = col.alt || "Watch video";
        if(!thumb) return "";
        return `<a href="${esc(withUTM(link,utm))}">
                  <img src="${esc(thumb)}"${wAttr}
                       style="display:block;width:100%;height:auto;border:0;outline:none;text-decoration:none;-ms-interpolation-mode:bicubic"
                       alt="${esc(alt)}">
                </a>`;
      }

      // image/gif
      const src  = col.value || "";
      const href2 = col.href || "";
      const alt2  = col.alt  || "";
      if(!src) return "";
      const img = `<img src="${esc(src)}"${wAttr}
                    style="display:block;width:100%;height:auto;border:0;outline:none;text-decoration:none;-ms-interpolation-mode:bicubic"
                    alt="${esc(alt2)}">`;
      return href2 ? (`<a href="${esc(withUTM(href2,utm))}">${img}</a>`) : img;
    }

    function buildContentHTML(rows, utm, hero){
      let html = "";

      if(hero.url){
        html += '<tr><td style="font-size:0; line-height:0; padding:0; text-align:center;" align="center">';
        if(hero.href){ html += '<a href="'+ esc(withUTM(hero.href,utm)) +'">'; }
        html += '<img src="'+ esc(hero.url) +'" width="600" style="display:block;width:100%;height:auto;border:0;outline:none;text-decoration:none;-ms-interpolation-mode:bicubic" alt="">';
        if(hero.href){ html += '</a>'; }
        html += '</td></tr>';
      }

      rows.forEach(row=>{
        if(!row.cols.length) return;
        // Row padding: must still render when "0" (so we don't check truthiness)
        const rowPadStyle = 'padding:' + (row.pad!=="" ? esc(row.pad) : '0') + ';';

        html += '<tr><td style="'+ rowPadStyle +' font-size:0; line-height:0;">' +
                '<table role="presentation" width="100%" border="0" cellpadding="0" cellspacing="0" ' +
                'style="border-collapse:collapse; border-spacing:0; mso-table-lspace:0pt; mso-table-rspace:0pt;"><tr>';

        const widthPct = Math.floor(100/row.cols.length);
        row.cols.forEach(c=>{
          const padStyle = 'padding:' + (c.pad!=="" ? esc(c.pad) : '0') + ';';
          const align = (c.align||"center").toLowerCase();
          const safeAlign = (align==="left"||align==="right") ? align : "center";
          html += '<td valign="top" align="'+ safeAlign +'" ' +
                  'style="'+ padStyle +' width:'+ widthPct +'%; font-size:0; line-height:0; text-align:'+ safeAlign +';">' +
                    buildCellHTML(c, utm) +
                  '</td>';
        });

        html += '</tr></table></td></tr>';
      });

      return html;
    }

    // ---------- full HTML builder ----------
    function readUTM(){
      return {
        utm_source: $("utm_source").value.trim(),
        utm_medium: $("utm_medium").value.trim(),
        utm_campaign: $("utm_campaign").value.trim(),
        utm_content: $("utm_content").value.trim(),
        utm_term: $("utm_term").value.trim()
      };
    }

    function buildFullHTML(){
      const utm = readUTM();
      const hero = { url: $("hero_url").value.trim(), href: $("hero_href").value.trim() };
      const rows = readRows();
      const hdrColor = $("hdr_color").value.trim();

      const bodyHTML =
        '<table align="center" border="0" cellpadding="0" cellspacing="0" ' +
        'style="margin:0 auto; font-family:Arial, Helvetica, sans-serif; max-width:600px; width:100%;' +
        'border-collapse:collapse; border-spacing:0; mso-table-lspace:0pt; mso-table-rspace:0pt;"><tbody>' +
          '<tr><td style="background-color:#ffffff; padding:0; font-size:0; line-height:0;">' +
            headerHTML(utm, hdrColor) +
            '<table role="presentation" align="center" border="0" cellpadding="0" cellspacing="0" ' +
                   'style="width:600px; max-width:600px; background:#ffffff; text-align:left;' +
                          'border-collapse:collapse; border-spacing:0; mso-table-lspace:0pt; mso-table-rspace:0pt;"><tbody>' +
              buildContentHTML(rows, utm, hero) +
            '</tbody></table>' +
            footerHTML(utm) +
            '<table align="center" border="0" cellpadding="0" cellspacing="0" ' +
                   'style="border-collapse:collapse; border-spacing:0; mso-table-lspace:0pt; mso-table-rspace:0pt;"></table>' +
          '</td></tr></tbody></table>';

      const full =
        '<!doctype html>\n<html>\n<head>\n' +
        '  <meta charset="utf-8">\n' +
        '  <meta name="x-apple-disable-message-reformatting">\n' +
        '  <meta name="viewport" content="width=device-width, initial-scale=1">\n' +
        '  <title>Netmeds Email</title>\n' +
        '</head>\n<body bgcolor="#ffffff" style="margin:0;padding:0;background-color:#ffffff;">\n' +
        bodyHTML + '\n</body>\n</html>';

      return full;
    }

    // ---------- actions ----------
    function generate(){
      const html = buildFullHTML();
      $("out_html").value = html;      // FULL HTML now
      $("preview").innerHTML = html;   // live preview
    }
    $("gen").onclick = generate;

    $("copy").onclick = async ()=>{
      if(!$("out_html").value.trim()) generate();
      const v = $("out_html").value;
      try{
        if(navigator.clipboard?.writeText){ await navigator.clipboard.writeText(v); }
        else{
          $("out_html").focus(); $("out_html").select();
          document.execCommand("copy");
        }
        const b=$("copy"), t=b.textContent; b.textContent="Copied ✓"; setTimeout(()=>b.textContent=t,1200);
      }catch(e){
        alert("Copy failed. Please select the text and press Ctrl/Cmd+C.");
      }
    };

    $("download").onclick = ()=>{
      if(!$("out_html").value.trim()) generate();
      const blob = new Blob([$ ("out_html").value], {type: "text/html;charset=utf-8"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = "netmeds-email.html";
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=> URL.revokeObjectURL(url), 1200);
    };
  })();
  </script>
</body>
</html>
